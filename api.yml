openapi: 3.0.3
info:
  title: PWA Push Notification API
  description: PWA ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥æ©Ÿèƒ½ã§ä½¿ç”¨ã•ã‚Œã‚‹ API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®è©³ç´°ä»•æ§˜
  version: 1.0.0
  contact:
    name: API Support
servers:
  - url: http://localhost:3000/api/push
    description: Development server
  - url: https://your-domain.com/api/push
    description: Production server

paths:
  /subscribe:
    get:
      tags:
        - Subscriptions
      summary: è³¼èª­çŠ¶æ³ç¢ºèª
      description: ç¾åœ¨ã®è³¼èª­çŠ¶æ³ã‚’å–å¾—ã—ã¾ã™
      operationId: getSubscriptions
      responses:
        "200":
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  total:
                    type: integer
                    description: ç¾åœ¨ã®ç·è³¼èª­æ•°
                    example: 1
                  subscriptions:
                    type: array
                    items:
                      type: object
                      properties:
                        endpoint:
                          type: string
                          description: ãƒ—ãƒƒã‚·ãƒ¥ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ URL
                          example: "https://fcm.googleapis.com/fcm/send/..."
                    description: è³¼èª­æƒ…å ±ã®é…åˆ—
              example:
                total: 1
                subscriptions:
                  - endpoint: "https://fcm.googleapis.com/fcm/send/..."
        "500":
          description: ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

    post:
      tags:
        - Subscriptions
      summary: è³¼èª­ç™»éŒ²
      description: ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ã®è³¼èª­ã‚’ç™»éŒ²ã—ã¾ã™
      operationId: subscribe
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - endpoint
                - keys
              properties:
                endpoint:
                  type: string
                  description: ãƒ—ãƒƒã‚·ãƒ¥ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ URL
                  example: "https://fcm.googleapis.com/fcm/send/..."
                keys:
                  type: object
                  required:
                    - p256dh
                    - auth
                  properties:
                    p256dh:
                      type: string
                      description: P-256 ECDH å…¬é–‹éµï¼ˆBase64 ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ï¼‰
                      example: "base64-encoded-p256dh-key"
                    auth:
                      type: string
                      description: èªè¨¼ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆï¼ˆBase64 ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ï¼‰
                      example: "base64-encoded-auth-key"
            example:
              endpoint: "https://fcm.googleapis.com/fcm/send/..."
              keys:
                p256dh: "base64-encoded-p256dh-key"
                auth: "base64-encoded-auth-key"
      responses:
        "200":
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    description: å‡¦ç†çµæœ
                    example: "subscribed"
                  total:
                    type: integer
                    description: ç¾åœ¨ã®ç·è³¼èª­æ•°
                    example: 1
                  isNew:
                    type: boolean
                    description: æ–°è¦è³¼èª­ã‹ã©ã†ã‹
                    example: true
              example:
                status: "subscribed"
                total: 1
                isNew: true
        "500":
          description: ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /send:
    post:
      tags:
        - Notifications
      summary: é€šçŸ¥é€ä¿¡
      description: ç™»éŒ²æ¸ˆã¿ã®è³¼èª­è€…ã«ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ã‚’é€ä¿¡ã—ã¾ã™
      operationId: sendNotification
      responses:
        "200":
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    description: å‡¦ç†çµæœ
                    example: "sent"
                  total:
                    type: integer
                    description: é€ä¿¡å¯¾è±¡ã®ç·æ•°
                    example: 1
                  successful:
                    type: integer
                    description: é€ä¿¡æˆåŠŸæ•°
                    example: 1
                  failed:
                    type: integer
                    description: é€ä¿¡å¤±æ•—æ•°
                    example: 0
                  results:
                    type: array
                    items:
                      type: object
                      properties:
                        success:
                          type: boolean
                          description: é€ä¿¡æˆåŠŸãƒ•ãƒ©ã‚°
                          example: true
                        index:
                          type: integer
                          description: é€ä¿¡ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
                          example: 0
                    description: å„é€ä¿¡ã®çµæœè©³ç´°
              example:
                status: "sent"
                total: 1
                successful: 1
                failed: 0
                results:
                  - success: true
                    index: 0
        "400":
          description: ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
              example:
                error: "ç™»éŒ²ã•ã‚ŒãŸé€šçŸ¥è³¼èª­è€…ãŒã„ã¾ã›ã‚“ã€‚ã¾ãšé€šçŸ¥ã‚’æœ‰åŠ¹ã«ã—ã¦ãã ã•ã„ã€‚"
        "500":
          description: ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /unsubscribe:
    post:
      tags:
        - Subscriptions
      summary: è³¼èª­è§£é™¤
      description: æŒ‡å®šã•ã‚ŒãŸã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®è³¼èª­ã‚’è§£é™¤ã—ã¾ã™
      operationId: unsubscribe
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - endpoint
              properties:
                endpoint:
                  type: string
                  description: è§£é™¤ã™ã‚‹è³¼èª­ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ URL
                  example: "https://fcm.googleapis.com/fcm/send/..."
            example:
              endpoint: "https://fcm.googleapis.com/fcm/send/..."
      responses:
        "200":
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    description: å‡¦ç†çµæœ
                    example: "unsubscribed"
                  message:
                    type: string
                    description: å‡¦ç†çµæœãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                    example: "è³¼èª­ã‚’è§£é™¤ã—ã¾ã—ãŸ"
                  total:
                    type: integer
                    description: å‰Šé™¤å¾Œã®ç·è³¼èª­æ•°
                    example: 0
              example:
                status: "unsubscribed"
                message: "è³¼èª­ã‚’è§£é™¤ã—ã¾ã—ãŸ"
                total: 0
        "404":
          description: è³¼èª­ãŒè¦‹ã¤ã‹ã‚‰ãªã„
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
              example:
                error: "æŒ‡å®šã•ã‚ŒãŸã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®è³¼èª­ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
        "500":
          description: ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /vapid:
    get:
      tags:
        - VAPID
      summary: VAPID éµå–å¾—
      description: VAPID å…¬é–‹éµã‚’å–å¾—ã—ã¾ã™
      operationId: getVapidKey
      responses:
        "200":
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  publicKey:
                    type: string
                    description: VAPID å…¬é–‹éµï¼ˆBase64 ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ï¼‰
                    example: "base64-encoded-public-key"
              example:
                publicKey: "base64-encoded-public-key"

components:
  schemas:
    Error:
      type: object
      properties:
        error:
          type: string
          description: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
          example: "é€šçŸ¥è³¼èª­ã®å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ"
      required:
        - error

    NotificationPayload:
      type: object
      description: é€ä¿¡ã•ã‚Œã‚‹é€šçŸ¥ã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰å½¢å¼
      properties:
        title:
          type: string
          description: é€šçŸ¥ã‚¿ã‚¤ãƒˆãƒ«
          example: "ğŸ‰ æ–°ã—ã„é€šçŸ¥ãŒå±Šãã¾ã—ãŸï¼"
        body:
          type: string
          description: é€šçŸ¥æœ¬æ–‡
          example: "ã“ã‚“ã«ã¡ã¯ï¼æ–°ã—ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã‚ã‚Šã¾ã™ã€‚\nå—ä¿¡æ™‚åˆ»: 2024/12/19 15:30:45"
        icon:
          type: string
          description: é€šçŸ¥ã‚¢ã‚¤ã‚³ãƒ³
          example: "/next.svg"
        badge:
          type: string
          description: é€šçŸ¥ãƒãƒƒã‚¸
          example: "/next.svg"
        image:
          type: string
          description: é€šçŸ¥ç”»åƒ
          example: "/globe.svg"
        tag:
          type: string
          description: é€šçŸ¥ã‚¿ã‚°
          example: "new-notification"
        data:
          type: object
          properties:
            url:
              type: string
              description: ã‚¯ãƒªãƒƒã‚¯æ™‚ã®é·ç§»å…ˆURL
              example: "/"
            timestamp:
              type: integer
              description: ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
              example: 1702971045000
            type:
              type: string
              description: é€šçŸ¥ã‚¿ã‚¤ãƒ—
              example: "info"
            priority:
              type: string
              description: å„ªå…ˆåº¦
              example: "high"
        requireInteraction:
          type: boolean
          description: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œãŒå¿…è¦ã‹ã©ã†ã‹
          example: true
        silent:
          type: boolean
          description: ã‚µã‚¤ãƒ¬ãƒ³ãƒˆé€šçŸ¥ã‹ã©ã†ã‹
          example: false
        vibrate:
          type: array
          items:
            type: integer
          description: ãƒã‚¤ãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³
          example: [200, 100, 200]
        actions:
          type: array
          items:
            type: object
            properties:
              action:
                type: string
                description: ã‚¢ã‚¯ã‚·ãƒ§ãƒ³è­˜åˆ¥å­
                example: "open"
              title:
                type: string
                description: ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒˆãƒ«
                example: "é–‹ã"
              icon:
                type: string
                description: ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¢ã‚¤ã‚³ãƒ³
                example: "/next.svg"
          description: é€šçŸ¥ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
          example:
            - action: "open"
              title: "é–‹ã"
              icon: "/next.svg"
            - action: "close"
              title: "é–‰ã˜ã‚‹"

tags:
  - name: Subscriptions
    description: è³¼èª­é–¢é€£ã®æ“ä½œ
  - name: Notifications
    description: é€šçŸ¥é€ä¿¡é–¢é€£ã®æ“ä½œ
  - name: VAPID
    description: VAPIDéµé–¢é€£ã®æ“ä½œ

security:
  - {} # ç¾åœ¨ã®å®Ÿè£…ã§ã¯èªè¨¼ä¸è¦
